<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>LAE Task Card App (Officer & LAE)</title>
  <style>
    body { font-family: Arial, sans-serif; background: #f2f6fc; margin:0; padding:0; }
    header { background: #8b0020; color: white; padding: 10px; text-align: center; }
    .container { padding: 20px; }
    .hidden { display:none; }
    .task { border:1px solid #ccc; border-radius:8px; margin:10px 0; padding:10px; background:white; }
    .task.done { background:#d4edda; }
    .task h4 { margin:0 0 5px; }
    .task small { color:#555; display:block; margin-top:5px; }
    button { margin:5px; padding:8px 12px; border:none; border-radius:6px; background:#8b0020; color:white; cursor:pointer; }
    button:hover { background:#a61e34; }
    select, input { padding:5px; margin:5px 0; }
  </style>
</head>
<body>
  <header>
    <h2>LAE Task Card App</h2>
    <button id="signOutBtn" class="hidden" onclick="signOut()">Sign Out</button>
    <button id="backBtn" class="hidden" onclick="goBack()">Back to Task List</button>
  </header>
  <div class="container">
    <!-- Login Screen -->
    <div id="loginScreen">
      <h3>Login</h3>
      <label>Name:</label>
      <select id="nameInput"></select><br>
      <label>Staff ID:</label>
      <input type="text" id="idInput"><br>
      <label>Role:</label>
      <select id="roleInput">
        <option value="">Select Role</option>
        <option value="officer">Officer</option>
        <option value="lae">LAE</option>
      </select><br>
      <button onclick="login()">Login</button>
    </div>

    <!-- Officer Screen -->
    <div id="officerScreen" class="hidden">
      <h3>Officer Dashboard</h3>
      <input type="file" id="excelFile" accept=".xlsx" />
      <button onclick="uploadExcel()">Upload Excel</button>
    </div>

    <!-- LAE Screen -->
    <div id="laeScreen" class="hidden">
      <h3>Task Cards</h3>
      <button onclick="showDoneTasks()">View Done Tasks</button>
      <div id="taskList"></div>
    </div>
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <script>
    // === Names from roster ===
    const demoNames = [
      "ABDUL FATAH BIN IBRAHIM","MOHD HAFIZ SAZWAN BIN ZAM ZAM","MOHAMMAD ZULKIFLEE BIN HUSSIN",
      "DING JU SHENG","LEE YOONG JUN","MUHAMMAD NAZIF BIN ABDUL MALEK",
      "UMEIR BIN SHUKRY OMAR TALIB","MOHD MAHDIR BIN ABDUL MANAN","ABU NOR RAZY BIN ABDULLAH @ ANBARASU",
      "ZARIN DARUS BIN ABDUL RAHMAN","MOHAMMAD ZAHID BIN AFTAB","AJMER SINGH A/L SUKHBIR SINGH"
      // ...continue with the full list you pasted
    ];

    function populateNames(){
      const sel=document.getElementById("nameInput");
      sel.innerHTML='<option value="">Select your name</option>';
      demoNames.forEach(n=>{
        let o=document.createElement("option");
        o.value=n; o.textContent=n; sel.appendChild(o);
      });
    }
    populateNames();

    let uploadedTasks = [];

    function login(){
      const name=document.getElementById("nameInput").value;
      const id=document.getElementById("idInput").value;
      const role=document.getElementById("roleInput").value;
      if(!name||!id||!role){ alert("Fill all fields"); return; }
      document.getElementById("loginScreen").classList.add("hidden");
      document.getElementById("signOutBtn").classList.remove("hidden");
      if(role==="officer"){ document.getElementById("officerScreen").classList.remove("hidden"); }
      else{ document.getElementById("laeScreen").classList.remove("hidden"); renderTasks(uploadedTasks); }
    }

    function signOut(){
      document.getElementById("loginScreen").classList.remove("hidden");
      document.getElementById("officerScreen").classList.add("hidden");
      document.getElementById("laeScreen").classList.add("hidden");
      document.getElementById("signOutBtn").classList.add("hidden");
      document.getElementById("backBtn").classList.add("hidden");
      document.getElementById("idInput").value="";
      document.getElementById("roleInput").value="";
      document.getElementById("nameInput").value="";
    }

    function uploadExcel(){
      const file=document.getElementById("excelFile").files[0];
      if(!file){ alert("Select Excel file"); return; }
      const reader=new FileReader();
      reader.onload=function(e){
        const data=new Uint8Array(e.target.result);
        const wb=XLSX.read(data,{type:'array'});
        const ws=wb.Sheets[wb.SheetNames[0]];
        const json=XLSX.utils.sheet_to_json(ws,{header:1});
        uploadedTasks=[];
        json.slice(1).forEach(row=>{
          if(row.length){
            uploadedTasks.push({
              card: row[0],
              description: row[1],
              ata: row[2],
              manhour: row[3]||"",
              due: row[4]||"",
              done:false
            });
          }
        });
        alert("Excel uploaded successfully!");
      };
      reader.readAsArrayBuffer(file);
    }

    function renderTasks(tasks){
      const list=document.getElementById("taskList");
      list.innerHTML="";
      if(!tasks.length){ list.innerHTML="<p>No tasks</p>"; return; }
      tasks.forEach((t,i)=>{
        const div=document.createElement("div");
        div.className="task"+(t.done?" done":"");
        div.innerHTML=`<h4>${t.card||"Task Card"}</h4>
          <p>${t.description||""}</p>
          <small>ATA: ${t.ata||""} | Manhour: ${t.manhour} | Due: ${t.due}</small><br>
          <label><input type="checkbox" ${t.done?"checked":""} onchange="toggleDone(${i})"> Done</label>`;
        list.appendChild(div);
      });
    }

    function toggleDone(index){
      uploadedTasks[index].done=!uploadedTasks[index].done;
      renderTasks(uploadedTasks);
    }

    function showDoneTasks(){
      const done=uploadedTasks.filter(t=>t.done);
      renderTasks(done);
      document.getElementById("backBtn").classList.remove("hidden");
    }

    function goBack(){
      renderTasks(uploadedTasks);
      document.getElementById("backBtn").classList.add("hidden");
    }
  </script>
</body>
</html>
