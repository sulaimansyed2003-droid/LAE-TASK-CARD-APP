<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>LAE Task Card System</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f0f6ff;
      margin: 0;
      padding: 0;
    }
    header {
      background: #8a1538; /* Batik Air maroon */
      color: white;
      text-align: center;
      padding: 15px;
    }
    .container {
      padding: 20px;
    }
    .card {
      border: 1px solid #ccc;
      background: white;
      margin: 10px 0;
      padding: 15px;
      border-radius: 8px;
    }
    .done {
      background: #d4edda;
    }
    button {
      background: #8a1538;
      color: white;
      border: none;
      padding: 10px 15px;
      margin-top: 10px;
      border-radius: 5px;
      cursor: pointer;
    }
    button:hover {
      background: #a61c44;
    }
    .hidden { display: none; }
    .flex { display: flex; gap: 10px; }
  </style>
</head>
<body>
  <header>
    <h1>LAE Task Card System</h1>
    <p id="dateTime"></p>
  </header>

  <div class="container">
    <!-- LOGIN SECTION -->
    <div id="loginSection">
      <h2>Login</h2>
      <label for="nameInput">Select Your Name:</label><br>
      <select id="nameInput"></select><br><br>

      <label for="idInput">Enter Your ID:</label><br>
      <input type="text" id="idInput"><br><br>

      <label for="roleInput">Select Role:</label><br>
      <select id="roleInput">
        <option value="">Select Role</option>
        <option value="Officer">Officer</option>
        <option value="LAE">LAE</option>
      </select><br><br>

      <button onclick="login()">Login</button>
    </div>

    <!-- OFFICER SECTION -->
    <div id="officerSection" class="hidden">
      <h2>Officer Panel</h2>
      <p>Upload Task Card Excel File:</p>
      <input type="file" id="excelFile" accept=".xlsx" />
      <div id="officerTasks"></div>
    </div>

    <!-- LAE SECTION -->
    <div id="laeSection" class="hidden">
      <h2>LAE Task Cards</h2>
      <button onclick="showAssignedOnly()">Show Assigned Tasks</button>
      <button onclick="showAllTasks()">Show All Tasks</button>
      <h3>Pending Tasks</h3>
      <div id="taskList"></div>
      <h3>Completed Tasks</h3>
      <div id="doneTasks"></div>
    </div>
  </div>

  <!-- SCRIPT -->
  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
  <script>
    /* =========================
       1. STAFF NAME LIST
    ========================== */
    const staffNames = [
      "ABDUL FATAH BIN IBRAHIM",
      "MOHD HAFIZ SAZWAN BIN ZAM ZAM",
      "MOHAMMAD ZULKIFLEE BIN HUSSIN",
      "DING JU SHENG",
      "LEE YOONG JUN",
      "MUHAMMAD NAZIF BIN ABDUL MALEK",
      "UMEIR BIN SHUKRY OMAR TALIB",
      "MOHD MAHDIR BIN ABDUL MANAN",
      "ABU NOR RAZY BIN ABDULLAH @ ANBARASU",
      "ZARIN DARUS BIN ABDUL RAHMAN",
      "MOHAMMAD ZAHID BIN AFTAB",
      "AJMER SINGH A/L SUKHBIR SINGH",
      "MOHD SYAKIR BIN ROSLE",
      "SASHVIREN SINGH A/L SUKHDEV SINGH",
      "MADIHAH BINTI MOHAMED KHAZIN",
      // âš¡ continue adding the rest of your list here...
    ];

    function populateNames() {
      const sel = document.getElementById("nameInput");
      sel.innerHTML = '<option value="">Select your name</option>';
      staffNames.forEach(name => {
        let opt = document.createElement("option");
        opt.value = name;
        opt.textContent = name;
        sel.appendChild(opt);
      });
    }
    document.addEventListener("DOMContentLoaded", populateNames);

    /* =========================
       2. LOGIN FUNCTION
    ========================== */
    let currentUser = null;
    let currentRole = null;
    let allTasks = [];
    let assignedTasks = {};

    function login() {
      const name = document.getElementById("nameInput").value;
      const role = document.getElementById("roleInput").value;
      if (!name || !role) { alert("Please select name and role"); return; }

      currentUser = name;
      currentRole = role;

      document.getElementById("loginSection").classList.add("hidden");

      if (role === "Officer") {
        document.getElementById("officerSection").classList.remove("hidden");
      } else {
        document.getElementById("laeSection").classList.remove("hidden");
        displayTasks();
      }
    }

    /* =========================
       3. OFFICER UPLOAD EXCEL
    ========================== */
    document.getElementById("excelFile").addEventListener("change", handleFile, false);

    function handleFile(e) {
      const file = e.target.files[0];
      const reader = new FileReader();
      reader.onload = function(event) {
        const data = new Uint8Array(event.target.result);
        const workbook = XLSX.read(data, { type: 'array' });
        const sheet = workbook.Sheets[workbook.SheetNames[0]];
        allTasks = XLSX.utils.sheet_to_json(sheet);
        alert("Excel uploaded successfully!");
        displayOfficerTasks();
      };
      reader.readAsArrayBuffer(file);
    }

    function displayOfficerTasks() {
      const container = document.getElementById("officerTasks");
      container.innerHTML = "";
      allTasks.forEach((task, index) => {
        let div = document.createElement("div");
        div.className = "card";
        div.innerHTML = `
          <b>Task ${index+1}</b><br>
          ${Object.entries(task).map(([k,v])=>`${k}: ${v}`).join("<br>")}<br>
          <label>Assign to:</label>
          <select onchange="assignTask(${index}, this.value)">
            <option value="">Unassigned</option>
            ${staffNames.map(n=>`<option value="${n}">${n}</option>`).join("")}
          </select>
        `;
        container.appendChild(div);
      });
    }

    function assignTask(taskIndex, name) {
      if (!assignedTasks[name]) assignedTasks[name] = [];
      assignedTasks[name].push(allTasks[taskIndex]);
      alert(`Task assigned to ${name}`);
    }

    /* =========================
       4. LAE VIEW TASKS
    ========================== */
    function displayTasks() {
      const container = document.getElementById("taskList");
      container.innerHTML = "";
      const userTasks = assignedTasks[currentUser] || allTasks; // show assigned or all
      userTasks.forEach((task, index) => {
        let div = document.createElement("div");
        div.className = "card";
        div.innerHTML = `
          <input type="checkbox" onchange="markDone(this, ${index})"> 
          <b>Task ${index+1}</b><br>
          ${Object.entries(task).map(([k,v])=>`${k}: ${v}`).join("<br>")}
        `;
        container.appendChild(div);
      });
    }

    function markDone(checkbox, index) {
      if (checkbox.checked) {
        const task = (assignedTasks[currentUser] || allTasks)[index];
        let div = document.createElement("div");
        div.className = "card done";
        div.innerHTML = `<b>DONE:</b><br>${Object.entries(task).map(([k,v])=>`${k}: ${v}`).join("<br>")}`;
        document.getElementById("doneTasks").appendChild(div);
        checkbox.parentElement.remove();
      }
    }

    function showAssignedOnly() {
      if (assignedTasks[currentUser]) {
        allTasks = assignedTasks[currentUser];
        displayTasks();
      } else {
        alert("No tasks assigned to you.");
      }
    }

    function showAllTasks() {
      displayTasks();
    }

    /* =========================
       5. DATE & TIME
    ========================== */
    function updateDateTime() {
      const now = new Date();
      document.getElementById("dateTime").textContent = now.toLocaleString("en-MY", { dateStyle:"full", timeStyle:"short" });
    }
    setInterval(updateDateTime, 1000);
    updateDateTime();
  </script>
</body>
</html>
