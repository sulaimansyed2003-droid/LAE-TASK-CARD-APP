<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>LAE Task Card App</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      background: #f8f8f8;
      color: #333;
    }
    header {
      background: #8B1538; /* Batik Air maroon */
      color: white;
      padding: 10px;
      text-align: center;
    }
    .container { padding: 20px; }
    .hidden { display: none; }
    button {
      background: #8B1538;
      color: white;
      padding: 6px 12px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }
    button:hover { background: #A91B45; }
    .task-card {
      border: 1px solid #ccc;
      padding: 10px;
      margin: 5px 0;
      border-radius: 6px;
      background: white;
    }
    .task-card.done { background: #d4edda; }
    .warning { color: red; font-weight: bold; }
    .progress-bar-container {
      background: #ddd;
      border-radius: 4px;
      overflow: hidden;
      height: 20px;
      margin-bottom: 10px;
    }
    .progress-bar {
      background: #8B1538;
      height: 100%;
      text-align: center;
      color: white;
      font-size: 12px;
    }
    .sticky-bar {
      position: sticky;
      top: 0;
      background: #fff;
      padding: 10px;
      z-index: 999;
      border-bottom: 1px solid #ccc;
    }
    input, select {
      padding: 5px;
      margin: 3px;
      border-radius: 4px;
      border: 1px solid #ccc;
    }
  </style>
</head>
<body>
  <header>
    <h1>LAE Task Card App</h1>
  </header>

  <!-- Login -->
  <div id="loginSection" class="container">
    <h2>Login</h2>
    <p>Name Search:</p>
    <input type="text" id="nameSearch" placeholder="Type to filter names...">
    <select id="name"></select>
    <br>
    <input type="text" id="staffId" placeholder="Staff ID">
    <br>
    <select id="role">
      <option value="">Select Role</option>
      <option value="LAE">LAE</option>
      <option value="OFFICER">Officer</option>
    </select>
    <br>
    <button onclick="continueLogin()">Continue</button>
  </div>

  <!-- Officer Section -->
  <div id="officerSection" class="container hidden">
    <div style="text-align:right;">
      <button onclick="signOut()">Sign Out</button>
    </div>
    <h2>Officer Panel</h2>
    <input type="file" id="excelFile" accept=".xlsx">
    <div class="sticky-bar">
      <input type="text" id="searchOfficer" placeholder="Search tasks...">
      <select id="ataFilterOfficer"></select>
    </div>
    <div id="taskListOfficer"></div>
  </div>

  <!-- LAE Section -->
  <div id="laeSection" class="container hidden">
    <div style="text-align:right;">
      <button onclick="signOut()">Sign Out</button>
    </div>
    <h2>Welcome, <span id="laeName"></span></h2>
    <p id="dateTime"></p>

    <h3>My Tasks</h3>
    <p id="progressText"></p>
    <div class="progress-bar-container"><div id="progressBar" class="progress-bar"></div></div>
    <div class="sticky-bar">
      <input type="text" id="searchMy" placeholder="Search my tasks...">
      <select id="ataFilterMy"></select>
    </div>
    <div id="myTasks"></div>

    <h3>All Tasks</h3>
    <div class="sticky-bar">
      <input type="text" id="searchAll" placeholder="Search all tasks...">
      <select id="ataFilterAll"></select>
    </div>
    <div id="allTasks"></div>
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <script>
    const malaysianNames = [
      "Ahmad Faiz", "Aisyah Binti Ali", "Amirul Hakim", "Azlan Shah", "Balqis Aina", "Farhan Zulkifli",
      "Fatin Nadia", "Hafiz Rahman", "Hakim Iskandar", "Hanis Zulaikha", "Harith Danish", "Haziq Aiman",
      "Imran Firdaus", "Iqbal Shafiq", "Izzah Syazwani", "Khairul Anwar", "Latifah Amin", "Liyana Sofea",
      "Maisarah Binti Musa", "Mohamad Danial", "Mohd Azim", "Muhammad Hafiz", "Muhammad Irfan", "Muhammad Rayyan",
      "Nabila Huda", "Najwa Binti Zain", "Noraishah Binti Omar", "Noraini Hashim", "Norul Ain", "Nur Afiqah",
      "Nur Amira", "Nur Athirah", "Nur Farah", "Nur Iman", "Nurul Ain", "Nurul Huda", "Puteri Balqis", "Qistina Afiqah",
      "Rafiq Ismail", "Roslan Jamal", "Safwan Hakim", "Siti Aisyah", "Siti Hajar", "Siti Nurhaliza", "Syafiq Aiman",
      "Syazana Binti Ali", "Wan Muhammad", "Yusof Abdullah", "Zainab Binti Ahmad", "Zulaikha Binti Zulkifli"
    ].sort();

    let currentUser = null;
    let allTasks = JSON.parse(localStorage.getItem("tasksData")) || [];
    let doneStatus = JSON.parse(localStorage.getItem("doneStatus")) || {};

    document.addEventListener("DOMContentLoaded", () => {
      const nameSelect = document.getElementById("name");
      malaysianNames.forEach(name => {
        let opt = document.createElement("option");
        opt.value = name;
        opt.textContent = name;
        nameSelect.appendChild(opt);
      });
      document.getElementById("nameSearch").addEventListener("input", function() {
        const filter = this.value.toLowerCase();
        Array.from(nameSelect.options).forEach(option => {
          option.style.display = option.text.toLowerCase().includes(filter) ? "" : "none";
        });
      });
      autoLogin();
    });

    function continueLogin() {
      const name = document.getElementById("name").value;
      const staffId = document.getElementById("staffId").value;
      const role = document.getElementById("role").value;
      console.log("Login attempt:", { name, staffId, role });

      if (!name || !staffId || !role) {
        alert("Please fill all fields");
        return;
      }
      currentUser = { name, staffId, role };
      localStorage.setItem("currentUser", JSON.stringify(currentUser));
      showSection();
    }

    function autoLogin() {
      const savedUser = localStorage.getItem("currentUser");
      if (savedUser) {
        currentUser = JSON.parse(savedUser);
        showSection();
      }
    }

    function showSection() {
      document.getElementById("loginSection").classList.add("hidden");
      if (currentUser.role === "OFFICER") {
        document.getElementById("officerSection").classList.remove("hidden");
        renderTasks("Officer");
      } else {
        document.getElementById("laeSection").classList.remove("hidden");
        document.getElementById("laeName").textContent = currentUser.name;
        updateDateTime();
        renderTasks("LAE");
      }
    }

    function signOut() {
      localStorage.removeItem("currentUser");
      currentUser = null;
      document.getElementById("loginSection").classList.remove("hidden");
      document.getElementById("officerSection").classList.add("hidden");
      document.getElementById("laeSection").classList.add("hidden");
    }

    function updateDateTime() {
      const now = new Date();
      document.getElementById("dateTime").textContent = now.toDateString() + " " + now.toLocaleTimeString();
    }

    document.getElementById("excelFile")?.addEventListener("change", handleExcelUpload);

    function handleExcelUpload(e) {
      const file = e.target.files[0];
      const reader = new FileReader();
      reader.onload = function(evt) {
        const data = new Uint8Array(evt.target.result);
        const workbook = XLSX.read(data, { type: 'array' });
        const sheetName = workbook.SheetNames[0];
        const sheet = XLSX.utils.sheet_to_json(workbook.Sheets[sheetName]);
        allTasks = sheet;
        localStorage.setItem("tasksData", JSON.stringify(allTasks));
        renderTasks("Officer");
      };
      reader.readAsArrayBuffer(file);
    }

    function renderTasks(view) {
      // TODO: implement filtering, ATA dynamic list, and task rendering with done status and progress.
      console.log("Rendering tasks for:", view);
    }
  </script>
</body>
</html>
