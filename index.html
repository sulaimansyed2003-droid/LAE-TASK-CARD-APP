<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>LAE Task Card App</title>
  <style>
    body { font-family: Arial, sans-serif; background:#f5f8ff; margin:0; padding:0; }
    header { background:#1a237e; color:#fff; padding:15px; text-align:center; font-size:20px; }
    .container { padding:20px; }
    .hidden { display:none; }
    .task-card { background:#fff; margin:12px 0; padding:15px; border-radius:10px; box-shadow:0 2px 5px rgba(0,0,0,0.15); }
    .task-meta { margin-bottom:8px; font-size:14px; }
    .task-meta b { color:#1a237e; }
    .task-desc { margin-top:8px; padding:10px; background:#f0f4ff; border-radius:8px; }
    .task-card.done { background:#d0ffd6; border:2px solid #4caf50; }
    .highlight-name { font-weight:bold; color:#d71920; } /* Batik Air red */
    select, button, input { margin-top:8px; padding:6px; border-radius:6px; border:1px solid #ccc; }
    .top-bar { display:flex; justify-content:space-between; align-items:center; margin-bottom:10px; }
    .status-bar { margin:10px 0; padding:10px; background:#e3f2fd; border-radius:8px; font-size:14px; }
  </style>
</head>
<body>
  <header>LAE Task Card App</header>
  <div class="container">
    <!-- Login -->
    <div id="loginSection">
      <h2>Sign In</h2>
      <label>Name:</label><br>
      <select id="nameInput"></select><br>
      <label>ID:</label><br>
      <input id="idInput" type="text"/><br>
      <label>Role:</label><br>
      <select id="roleInput">
        <option value="">Select</option>
        <option value="officer">Officer</option>
        <option value="lae">LAE</option>
      </select><br>
      <button onclick="login()">Sign In</button>
    </div>

    <!-- Dashboard -->
    <div id="dashboard" class="hidden">
      <div class="top-bar">
        <div id="welcome"></div>
        <button onclick="logout()">Sign Out</button>
      </div>
      <div class="status-bar">
        Date: <span id="currentDate"></span> |
        Time: <span id="currentTime"></span><br>
        Task Done: <span id="doneCount">0</span> |
        Remaining: <span id="remainingCount">0</span>
      </div>

      <div id="officerControls" class="hidden">
        <h3>Officer Panel</h3>
        <input type="file" id="excelFile" accept=".xlsx"/>
        <button onclick="uploadExcel()">Upload Excel</button>
      </div>

      <div id="filterSection">
        <h3>Filter by ATA</h3>
        <select id="ataFilter" onchange="filterTasks()">
          <option value="all">All ATA</option>
        </select>
      </div>

      <h3>Task Cards</h3>
      <div id="taskList"></div>

      <h3>Finished Tasks</h3>
      <div id="finishedList"></div>
    </div>
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <script>
    const names = [
      "ABDUL FATAH BIN IBRAHIM","MOHD HAFIZ SAZWAN BIN ZAM ZAM","MOHAMMAD ZULKIFLEE BIN HUSSIN",
      "DING JU SHENG","LEE YOONG JUN","MUHAMMAD NAZIF BIN ABDUL MALEK","UMEIR BIN SHUKRY OMAR TALIB",
      "MOHD MAHDIR BIN ABDUL MANAN","ABU NOR RAZY BIN ABDULLAH @ ANBARASU","ZARIN DARUS BIN ABDUL RAHMAN",
      "MOHAMMAD ZAHID BIN AFTAB","AJMER SINGH A/L SUKHBIR SINGH","MOHD SYAKIR BIN ROSLE",
      "SASHVIREN SINGH A/L SUKHDEV SINGH","MADIHAH BINTI MOHAMED KHAZIN"
      // â€¦ (continue with full list of ~400 names from your roster)
    ];

    let currentUser = null;
    let tasks = [];

    function populateNames(){
      const sel=document.getElementById("nameInput");
      sel.innerHTML='<option value="">Select your name</option>';
      names.forEach(n=>{
        let o=document.createElement("option");
        o.value=n; o.textContent=n;
        sel.appendChild(o);
      });
    }
    populateNames();

    function login(){
      const name=document.getElementById("nameInput").value;
      const id=document.getElementById("idInput").value;
      const role=document.getElementById("roleInput").value;
      if(!name||!id||!role){ alert("Fill all fields"); return; }
      currentUser={name,id,role};
      document.getElementById("loginSection").classList.add("hidden");
      document.getElementById("dashboard").classList.remove("hidden");
      document.getElementById("welcome").textContent="Welcome, "+name+" ("+role+")";
      if(role==="officer"){ document.getElementById("officerControls").classList.remove("hidden"); }
      renderTasks();
    }

    function logout(){
      currentUser=null;
      document.getElementById("loginSection").classList.remove("hidden");
      document.getElementById("dashboard").classList.add("hidden");
      document.getElementById("idInput").value="";
      document.getElementById("roleInput").value="";
      document.getElementById("nameInput").value="";
    }

    function uploadExcel(){
      const file=document.getElementById("excelFile").files[0];
      if(!file){ alert("No file selected"); return; }
      const reader=new FileReader();
      reader.onload=(e)=>{
        const data=new Uint8Array(e.target.result);
        const workbook=XLSX.read(data,{type:'array'});
        const sheet=workbook.Sheets[workbook.SheetNames[0]];
        tasks=XLSX.utils.sheet_to_json(sheet);
        renderTasks();
      };
      reader.readAsArrayBuffer(file);
    }

    function filterTasks(){
      renderTasks();
    }

    function renderTasks(){
      const taskList=document.getElementById("taskList");
      const finishedList=document.getElementById("finishedList");
      taskList.innerHTML=""; finishedList.innerHTML="";
      let ataFilter=document.getElementById("ataFilter").value;

      let done=0, remaining=0;

      tasks.forEach((t,i)=>{
        if(ataFilter!=="all" && t.ATA!=ataFilter) return;
        let card=document.createElement("div");
        card.className="task-card"+(t.done?" done":"");

        card.innerHTML=`
          <div class="task-meta">
            <b>ATA:</b> ${t.ATA||"N/A"} |
            <b>Manhour:</b> ${t.Manhour||"N/A"} |
            <b>Due:</b> ${t.Due||"N/A"} |
            <b>Assigned To:</b> ${t.assignedTo? "<span class='highlight-name'>"+t.assignedTo+"</span>":"None"}
          </div>
          <div class="task-desc"><b>Task Card:</b> ${t["Task Card"]||"N/A"}</div>
          <div class="task-desc"><b>Description:</b> ${t.Description||"N/A"}</div>
          ${currentUser.role==="officer"?`
            <div><label>Assign: </label><select onchange="assignTask(${i},this.value)">
              <option value="">Assign to...</option>
              ${names.map(n=>`<option value="${n}">${n}</option>`).join("")}
            </select></div>`:""}
          <div><label><input type="checkbox" ${t.done?"checked":""} onchange="toggleDone(${i},this.checked)"> Mark Done</label></div>
        `;

        if(t.done){ done++; finishedList.appendChild(card); }
        else{ remaining++; taskList.appendChild(card); }
      });

      document.getElementById("doneCount").textContent=done;
      document.getElementById("remainingCount").textContent=remaining;
    }

    function assignTask(index,name){
      tasks[index].assignedTo=name;
      renderTasks();
    }

    function toggleDone(index,checked){
      tasks[index].done=checked;
      renderTasks();
    }

    // Clock updater
    function updateClock(){
      const now=new Date();
      document.getElementById("currentDate").textContent=now.toLocaleDateString('en-GB',{weekday:"long",year:"numeric",month:"long",day:"numeric"});
      document.getElementById("currentTime").textContent=now.toLocaleTimeString();
    }
    setInterval(updateClock,1000);
    updateClock();
  </script>
</body>
</html>
