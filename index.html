<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Batik Air Task Card System</title>
  <style>
    body { font-family: Arial, sans-serif; background:#f7f9fc; margin:0; padding:0; }
    header { background:#6c1d45; color:white; padding:10px; text-align:center; }
    .container { padding:20px; }
    .task { border:1px solid #ccc; border-radius:8px; padding:12px; margin-bottom:12px; background:white; }
    .task.done { background:#d4edda; border-color:#28a745; }
    h3 { margin-top:0; }
    .hidden { display:none; }
    .stats { margin:10px 0; padding:10px; background:#eee; border-radius:6px; }
    select, input, button { padding:6px; margin:4px; }
    .topbar { display:flex; justify-content:space-between; align-items:center; margin-bottom:15px; }
    .btn { background:#6c1d45; color:white; border:none; border-radius:5px; padding:8px 14px; cursor:pointer; }
    .btn:hover { background:#9c2d68; }
  </style>
</head>
<body>
  <header>
    <h2>Batik Air Task Card System</h2>
  </header>

  <div class="container">
    <!-- Login Section -->
    <div id="loginSection">
      <h3>Sign In</h3>
      <label>Name: 
        <select id="nameInput"></select>
      </label><br>
      <label>ID: <input type="text" id="idInput"></label><br>
      <label>Role:
        <select id="roleInput">
          <option value="">Select Role</option>
          <option value="LAE">LAE</option>
          <option value="OFFICER">Officer</option>
        </select>
      </label><br>
      <button class="btn" onclick="login()">Login</button>
    </div>

    <!-- Officer Section -->
    <div id="officerSection" class="hidden">
      <div class="topbar">
        <div>
          <input type="file" id="excelFile" accept=".xlsx">
          <button class="btn" onclick="loadExcel()">Upload Excel</button>
          <select id="officerAtaFilter" onchange="filterOfficerATA()">
            <option value="All">All ATA</option>
            ${[...Array(40)].map((_,i)=>`<option value="ATA${String(i+1).padStart(2,'0')}">ATA${String(i+1).padStart(2,'0')}</option>`).join("")}
          </select>
        </div>
        <div>
          <span id="dateTime"></span>
          <button class="btn" onclick="signOut()">Sign Out</button>
        </div>
      </div>
      <div class="stats" id="officerStats"></div>
      <h3>All Task Cards</h3>
      <div id="officerTaskList"></div>
    </div>

    <!-- LAE Section -->
    <div id="laeSection" class="hidden">
      <div class="topbar">
        <div>
          <button class="btn" onclick="showAllTasks()">All Tasks</button>
          <button class="btn" onclick="showMyTasks()">Assigned to Me</button>
          <select id="laeAtaFilter" onchange="filterLaeATA()">
            <option value="All">All ATA</option>
            ${[...Array(40)].map((_,i)=>`<option value="ATA${String(i+1).padStart(2,'0')}">ATA${String(i+1).padStart(2,'0')}</option>`).join("")}
          </select>
        </div>
        <div>
          <span id="dateTime"></span>
          <button class="btn" onclick="signOut()">Sign Out</button>
        </div>
      </div>
      <div class="stats" id="laeStats"></div>
      <h3>Remaining Task Cards</h3>
      <div id="taskList"></div>
      <h3>Done Task Cards</h3>
      <div id="doneList"></div>
    </div>
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <script>
    // ===== Names (from roster you gave, shortened example) =====
    const demoNames = [
      "ABDUL FATAH BIN IBRAHIM","MOHD HAFIZ SAZWAN BIN ZAM ZAM","MOHAMMAD ZULKIFLEE BIN HUSSIN",
      "DING JU SHENG","LEE YOONG JUN","MUHAMMAD NAZIF BIN ABDUL MALEK",
      "UMEIR BIN SHUKRY OMAR TALIB","MOHD MAHDIR BIN ABDUL MANAN","ABU NOR RAZY BIN ABDULLAH @ ANBARASU",
      "ZARIN DARUS BIN ABDUL RAHMAN","MOHAMMAD ZAHID BIN AFTAB","AJMER SINGH A/L SUKHBIR SINGH",
      // ... (continue with your full ~400 names here)
    ];

    let tasks = [];
    let currentUser = null;
    let currentLaeFilter = "All";
    let currentOfficerFilter = "All";

    // Populate names in dropdown
    function populateNames(){
      const sel=document.getElementById("nameInput");
      sel.innerHTML='<option value="">Select your name</option>';
      demoNames.forEach(n=>{
        let o=document.createElement("option");
        o.value=n; o.textContent=n;
        sel.appendChild(o);
      });
    }
    populateNames();

    function login(){
      const name=document.getElementById("nameInput").value;
      const id=document.getElementById("idInput").value;
      const role=document.getElementById("roleInput").value;
      if(!name||!id||!role){alert("Fill all fields"); return;}
      currentUser={name,id,role};
      document.getElementById("loginSection").classList.add("hidden");
      if(role==="OFFICER") document.getElementById("officerSection").classList.remove("hidden");
      if(role==="LAE") document.getElementById("laeSection").classList.remove("hidden");
      updateDateTime();
    }

    function signOut(){
      currentUser=null;
      document.getElementById("officerSection").classList.add("hidden");
      document.getElementById("laeSection").classList.add("hidden");
      document.getElementById("loginSection").classList.remove("hidden");
    }

    // update date and time continuously
    function updateDateTime(){
      setInterval(()=>{
        const now=new Date();
        const options={ weekday:'long', year:'numeric', month:'long', day:'numeric', 
          hour:'2-digit', minute:'2-digit', second:'2-digit' };
        document.querySelectorAll("#dateTime").forEach(el=>{
          el.innerText="Today: "+now.toLocaleDateString("en-MY",options);
        });
      },1000);
    }

    // Load Excel file
    function loadExcel(){
      const file=document.getElementById("excelFile").files[0];
      if(!file) return;
      const reader=new FileReader();
      reader.onload=(e)=>{
        const data=new Uint8Array(e.target.result);
        const wb=XLSX.read(data,{type:"array"});
        const ws=wb.Sheets[wb.SheetNames[0]];
        const json=XLSX.utils.sheet_to_json(ws,{header:1});
        tasks=json.slice(1).map(r=>({
          ata:r[0]||"", card:r[1]||"", description:r[2]||"",
          tools:r[3]||"", consumables:r[4]||"", remarks:r[5]||"",
          manhour:r[6]||"", due:r[7]||"", assignedTo:r[8]||"",
          done:false, markedBy:""
        }));
        renderOfficerTasks(tasks);
      };
      reader.readAsArrayBuffer(file);
    }

    // Render LAE tasks
    function renderTasks(ts){
      const list=document.getElementById("taskList");
      const doneList=document.getElementById("doneList");
      list.innerHTML=""; doneList.innerHTML="";
      let filtered = currentLaeFilter==="All"?ts:ts.filter(t=>t.ata===currentLaeFilter);
      filtered.forEach((t,i)=>{
        const div=document.createElement("div");
        div.className="task"+(t.done?" done":"");
        let checkbox="";
        if(t.assignedTo===currentUser.name){
          checkbox=`<label><input type="checkbox" ${t.done?"checked":""} onchange="toggleDone(${i})"> Done</label>`;
        }
        div.innerHTML=`
          <h4>${t.ata}</h4>
          <small>ATA: ${t.ata} | Manhour: ${t.manhour} | Due: ${t.due} | Assigned To: ${t.assignedTo||"None"}</small>
          <p><b>Task Card:</b> ${t.card}</p>
          <p><b>Description:</b> ${t.description}</p>
          ${t.tools?`<p><b>Tools:</b> ${t.tools}</p>`:""}
          ${t.consumables?`<p><b>Consumables:</b> ${t.consumables}</p>`:""}
          ${t.remarks?`<p><b>Remarks:</b> ${t.remarks}</p>`:""}
          ${checkbox}
          ${t.done?`<br><b>Marked done by:</b> ${t.markedBy}`:""}
        `;
        if(t.done) doneList.appendChild(div); else list.appendChild(div);
      });
      updateStats(filtered);
    }

    // Render Officer tasks
    function renderOfficerTasks(ts){
      const list=document.getElementById("officerTaskList");
      list.innerHTML="";
      let filtered = currentOfficerFilter==="All"?ts:ts.filter(t=>t.ata===currentOfficerFilter);
      filtered.forEach((t,i)=>{
        const div=document.createElement("div");
        div.className="task"+(t.done?" done":"");
        let dropdown=`<select onchange="assignTask(${i}, this.value)">
            <option value="">Assign to...</option>
            ${demoNames.map(n=>`<option value="${n}" ${t.assignedTo===n?"selected":""}>${n}</option>`).join("")}
          </select>`;
        div.innerHTML=`
          <h4>${t.ata}</h4>
          <small>ATA: ${t.ata} | Manhour: ${t.manhour} | Due: ${t.due} | Assigned To: ${t.assignedTo||"None"}</small>
          <p><b>Task Card:</b> ${t.card}</p>
          <p><b>Description:</b> ${t.description}</p>
          ${t.tools?`<p><b>Tools:</b> ${t.tools}</p>`:""}
          ${t.consumables?`<p><b>Consumables:</b> ${t.consumables}</p>`:""}
          ${t.remarks?`<p><b>Remarks:</b> ${t.remarks}</p>`:""}
          <div><b>Assign:</b> ${dropdown}</div>
          ${t.done?`<br><b>Marked done by:</b> ${t.markedBy}`:""}
        `;
        list.appendChild(div);
      });
      updateOfficerStats(filtered);
    }

    // Assign task to LAE
    function assignTask(i,name){
      tasks[i].assignedTo=name;
      renderOfficerTasks(tasks);
    }

    // Toggle LAE done
    function toggleDone(i){
      tasks[i].done=!tasks[i].done;
      if(tasks[i].done) tasks[i].markedBy=currentUser.name;
      renderTasks(tasks);
    }

    // Stats
    function updateStats(ts){
      const total=ts.length, done=ts.filter(t=>t.done).length, remaining=total-done, assigned=ts.filter(t=>t.assignedTo===currentUser.name).length;
      document.getElementById("laeStats").innerText=`Total: ${total} | Done: ${done} | Remaining: ${remaining} | Assigned to You: ${assigned}`;
    }
    function updateOfficerStats(ts){
      const total=ts.length, done=ts.filter(t=>t.done).length, remaining=total-done;
      document.getElementById("officerStats").innerText=`Total: ${total} | Done: ${done} | Remaining: ${remaining}`;
    }

    // Filters
    function filterLaeATA(){ currentLaeFilter=document.getElementById("laeAtaFilter").value; renderTasks(tasks); }
    function filterOfficerATA(){ currentOfficerFilter=document.getElementById("officerAtaFilter").value; renderOfficerTasks(tasks); }

    // Show all tasks or my tasks
    function showAllTasks(){ renderTasks(tasks); }
    function showMyTasks(){ renderTasks(tasks.filter(t=>t.assignedTo===currentUser.name)); }

  </script>
</body>
</html>
