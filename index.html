<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Batik Air – Task Card App</title>

  <!-- PWA manifest + theme -->
  <link rel="manifest" href="manifest.json" />
  <meta name="theme-color" content="#9c1b43" />

  <!-- SheetJS for Excel (.xlsx) parsing -->
  <script src="https://cdn.jsdelivr.net/npm/xlsx/dist/xlsx.full.min.js"></script>

  <style>
    /* ===== Batik Air theme (maroon & gold) ===== */
    :root{
      --bg:#0b0d12;
      --panel:#11151d;
      --ink:#f3f4f6;
      --muted:#aab0bc;
      --brand:#9c1b43;  /* Batik Air maroon */
      --brand-2:#f0b12b;/* Batik Air gold */
      --card:#0e121a;
      --ok:#10b981;
      --warn:#f59e0b;
      --due:#ef4444;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial,sans-serif;
      background:linear-gradient(180deg,#0b0d12,#0f1420);
      color:var(--ink);
    }
    .container{max-width:1100px;margin:0 auto;padding:20px}
    .glass{background:rgba(255,255,255,.04);border:1px solid rgba(255,255,255,.08);backdrop-filter:blur(6px);border-radius:16px;box-shadow:0 10px 30px rgba(0,0,0,.35)}
    header{display:flex;align-items:center;justify-content:space-between;gap:16px;margin:12px 0 20px}
    h1{margin:0;font-size:1.2rem}
    .pill{border:1px solid rgba(255,255,255,.14);border-radius:999px;padding:6px 10px;color:#e5e7eb;font-size:.82rem}
    .brand{color:#fff;background:linear-gradient(90deg,var(--brand),#b8204f)}
    .row{display:flex;flex-wrap:wrap;gap:16px}
    .col{flex:1;min-width:280px}
    .card{background:var(--card);border:1px solid rgba(255,255,255,.06);border-radius:16px;padding:16px}
    label{display:block;color:var(--muted);font-size:.85rem;margin:12px 0 6px}
    input,select,textarea{
      width:100%;padding:10px 12px;border-radius:10px;border:1px solid rgba(255,255,255,.14);
      background:#0e1422;color:var(--ink)
    }
    textarea{min-height:90px}
    .btn{border:0;border-radius:12px;padding:10px 14px;font-weight:600;cursor:pointer}
    .btn.primary{background:linear-gradient(90deg,var(--brand),#b8204f);color:white}
    .btn.ghost{background:transparent;border:1px solid rgba(255,255,255,.16);color:var(--ink)}
    .btn.warn{background:var(--warn);color:#2d1c00}
    .btn.ok{background:var(--ok);color:#012416}
    .btn.danger{background:var(--due);color:#2a0b0b}
    .toolbar{display:flex;gap:10px;flex-wrap:wrap}
    .tabbar{display:flex;gap:8px;flex-wrap:wrap;margin:10px 0}
    .tab{padding:10px 12px;border-radius:10px;border:1px solid rgba(255,255,255,.14);cursor:pointer;background:#0e1422}
    .tab.active{outline:2px solid var(--brand);background:rgba(156,27,67,.15)}
    .muted{color:var(--muted)}
    .grid{display:grid;gap:12px}
    .grid.two{grid-template-columns:repeat(2,minmax(0,1fr))}
    @media (max-width:880px){.grid.two{grid-template-columns:1fr}}
    table{width:100%;border-collapse:collapse;margin-top:8px}
    th,td{padding:10px;border-bottom:1px solid rgba(255,255,255,.08);vertical-align:top;text-align:left}
    th{font-size:.85rem;color:var(--muted)}
    tr:hover{background:rgba(255,255,255,.035)}
    .scroller{max-height:160px;overflow:auto;border:1px solid rgba(255,255,255,.08);border-radius:10px;padding:8px;background:#0e1422}
    .due-chip{display:inline-block;padding:2px 8px;border-radius:999px;font-size:.75rem;font-weight:700}
    .due-ok{background:rgba(16,185,129,.15)}
    .due-soon{background:rgba(245,158,11,.18)}
    .due-today{background:rgba(240,177,43,.25);outline:1px solid var(--brand-2)}
    .due-overdue{background:rgba(239,68,68,.18);outline:1px solid var(--due)}
    .logoRow{display:flex;align-items:center;gap:14px}
    .logo{width:120px;height:auto;border-radius:10px;background:white;padding:6px}
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>Batik Air – Task Card App</h1>
      <div class="pill" id="sessionPill">Not signed in</div>
    </header>

    <!-- ========= SIGN IN ========= -->
    <section id="auth" class="glass card">
      <div class="row">
        <div class="col">
          <div class="logoRow">
            <!-- You can replace the src with your hosted file path -->
            <img class="logo" src="https://raw.githubusercontent.com/simple-icons/simple-icons/develop/icons/batikair.svg" alt="Batik Air logo" onerror="this.src='https://upload.wikimedia.org/wikipedia/commons/thumb/a/a7/Placeholder_logo.png/120px-Placeholder_logo.png'">
            <div>
              <h2 style="margin:0 0 6px">Sign in</h2>
              <p class="muted" style="margin:0">Use your name, Staff ID and choose LAE or OFFICER.</p>
            </div>
          </div>

          <label>Your name</label>
          <input id="nameInput" placeholder="e.g. Aiman" />
          <label>Staff ID</label>
          <input id="staffInput" placeholder="e.g. BID1234" />
          <label>Role</label>
          <select id="roleInput">
            <option value="LAE">LAE</option>
            <option value="OFFICER">OFFICER</option>
          </select>
          <div class="toolbar" style="margin-top:12px">
            <button class="btn primary" onclick="signIn()">Continue</button>
            <button class="btn ghost" onclick="seedDemo()">Load demo data</button>
          </div>
        </div>

        <div class="col">
          <div class="card">
            <b>After sign-in</b>
            <ul class="muted" style="margin-top:8px">
              <li>Officer can import an Excel (.xlsx) and edit Due Date & Man Hours.</li>
              <li>LAE can search, filter by ATA, and mark tasks completed.</li>
              <li>Colour warnings show due status (Soon/Today/Overdue).</li>
            </ul>
          </div>
        </div>
      </div>
    </section>

    <!-- ========= APP SHELL ========= -->
    <section id="app" class="glass card" style="display:none">
      <div class="toolbar" style="justify-content:space-between;align-items:center">
        <div class="toolbar">
          <button class="btn ghost" onclick="goBack()">◀ Back</button>
          <div class="pill" id="whoPill">—</div>
        </div>
        <div class="tabbar" id="tabs"></div>
      </div>

      <!-- Top status row -->
      <div class="row" style="margin:6px 0 10px">
        <div class="pill brand" id="todayPill">—</div>
        <div class="pill" id="remainingPill">—</div>
      </div>

      <!-- ===== LAE: Search & View ===== -->
      <section id="tab-search" style="display:none">
        <div class="grid two">
          <div>
            <label>ATA Chapter</label>
            <select id="ataFilter" onchange="renderSearch()"></select>
          </div>
          <div>
            <label>Search by Task Card / AMM or Description</label>
            <input id="searchInput" placeholder="e.g. 32-070-00-01 or 'servicing'" oninput="renderSearch()" />
          </div>
        </div>
        <div id="searchResults" style="margin-top:8px"></div>
      </section>

      <!-- ===== OFFICER: Import & Edit ===== -->
      <section id="tab-manage" style="display:none">
        <div class="grid two">
          <div class="card">
            <h3 style="margin:0 0 8px">Import Excel (.xlsx)</h3>
            <p class="muted">Expected columns (any order): <i>TASK CARD NUM / AMM REF</i>, <i>TASK DESCRIPTION</i>, <i>TOOLS / TESTSET</i>, <i>CONSUMABLES / MSL</i>, <i>REMARKS</i>, <i>DURATION</i>, optional <i>ATA</i>. We’ll add <b>Due Date</b> and <b>Man Hours</b>.</p>
            <div class="toolbar">
              <input type="file" id="excelFile" accept=".xlsx" style="display:none" />
              <button class="btn warn" onclick="document.getElementById('excelFile').click()">Choose .xlsx</button>
              <button class="btn ghost" onclick="exportJSON()">Export JSON</button>
              <button class="btn danger" onclick="clearAll()">Clear all data</button>
            </div>
          </div>

          <div class="card">
            <h3 style="margin:0 0 8px">Quick edit: Due Date & Man Hours</h3>
            <p class="muted">Click a row to edit. Changes save automatically.</p>
            <div id="listWrap" class="scroller" style="max-height:340px"></div>
          </div>
        </div>
      </section>
    </section>

    <div class="toolbar" style="justify-content:center;margin-top:14px">
      <button class="btn ghost" onclick="signOut()">Sign out</button>
    </div>
  </div>

  <script>
    /***********************
     * Minimal state model *
     ***********************/
    const STORAGE_KEY = 'batik_taskcards_v1';
    let state = {
      user:null,              // {name, staffId, role}
      tasks:[],               // array of task objects
      history:[],             // in-app back stack
      editId:null
    };

    // Task shape reference:
    // { id, ata, tc, desc, tools, cons, rem, dur, manHours, dueDate, completed:false }

    const uid = () => 'id-' + Math.random().toString(36).slice(2,10) + Date.now().toString(36);

    function todayLabel(){
      const d = new Date();
      return d.toLocaleDateString(undefined,{weekday:'long',year:'numeric',month:'short',day:'numeric'});
    }

    function loadLocal(){
      try{
        const raw = localStorage.getItem(STORAGE_KEY);
        if(raw){ const obj = JSON.parse(raw); state.tasks = obj.tasks||[]; }
      }catch(e){ console.warn('Local load failed', e); }
    }
    function saveLocal(){
      try{ localStorage.setItem(STORAGE_KEY, JSON.stringify({tasks: state.tasks})) }catch(e){ console.warn('Local save failed', e); }
    }

    /***************
     * AUTH & NAV  *
     ***************/
    function signIn(){
      const name = (document.getElementById('nameInput').value||'User').trim();
      const staffId = (document.getElementById('staffInput').value||'').trim();
      const role = document.getElementById('roleInput').value;
      if(!staffId){ alert('Please enter Staff ID'); return; }
      state.user = {name, staffId, role};
      document.getElementById('sessionPill').textContent = `${role} — ${name}`;
      document.getElementById('whoPill').textContent = `${role} • ${staffId}`;
      document.getElementById('todayPill').textContent = todayLabel();
      document.getElementById('auth').style.display='none';
      document.getElementById('app').style.display='block';
      state.history=['home'];
      loadLocal();
      buildTabs();
      renderAll();
    }
    function signOut(){ location.reload(); }
    function goBack(){
      if(state.history.length>1){
        state.history.pop();
        setTab(state.history[state.history.length-1]);
      }else{
        setTab(state.user.role==='OFFICER'?'manage':'search');
      }
    }

    function buildTabs(){
      const tabs = document.getElementById('tabs');
      tabs.innerHTML='';
      const make=(id,label)=>{ const b=document.createElement('button'); b.className='tab'; b.textContent=label; b.onclick=()=>setTab(id); return b; }
      if(state.user.role==='OFFICER'){
        tabs.appendChild(make('manage','Manage'));
        tabs.appendChild(make('search','Search'));
        setTab('manage');
      }else{
        tabs.appendChild(make('search','Search'));
        setTab('search');
      }
    }
    function setTab(id){
      document.querySelectorAll('[id^="tab-"]').forEach(el=>el.style.display='none');
      document.getElementById('tab-'+id).style.display='block';
      document.querySelectorAll('.tabbar .tab').forEach(b=>b.classList.remove('active'));
      const order = (state.user.role==='OFFICER')?['manage','search']:['search'];
      const idx = order.indexOf(id);
      if(idx>-1) document.querySelectorAll('.tabbar .tab')[idx].classList.add('active');
      if(state.history[state.history.length-1]!==id) state.history.push(id);
      renderAll();
    }

    /**********************
     * IMPORT & MAPPINGS  *
     **********************/
    document.getElementById('excelFile').addEventListener('change', handleExcelFile);

    function handleExcelFile(ev){
      const file = ev.target.files[0];
      if(!file){ alert('No file selected'); return; }
      const reader = new FileReader();
      reader.onload = (e)=>{
        try{
          const data = new Uint8Array(e.target.result);
          const wb = XLSX.read(data, { type: 'array' });
          const ws = wb.Sheets[wb.SheetNames[0]];
          const rows = XLSX.utils.sheet_to_json(ws, {header:1, defval:'', blankrows:false});
          const parsed = parseExcelRows(rows);
          if(!parsed.length){ alert('No tasks parsed. Please check column headers.'); return; }
          // assign ids and merge
          parsed.forEach(t=>t.id=uid());
          state.tasks = [...parsed, ...state.tasks];
          saveLocal();
          ev.target.value='';
          alert(`Imported ${parsed.length} task(s).`);
          renderAll();
        }catch(err){
          console.error(err); alert('Failed to parse Excel.');
        }
      };
      reader.readAsArrayBuffer(file);
    }

    // Flexible header detection; will match your screenshot headers.
    function parseExcelRows(rows){
      let currentATA = '';
      let headerIdx = -1; let cols = {};
      const out = [];

      for(let r=0;r<rows.length;r++){
        const row = rows[r].map(v=>String(v).trim());
        if(row.length===0) continue;

        // Detect "ATA 12" style lines to carry forward
        const firstUpper = (row[0]||'').toUpperCase();
        const m = firstUpper.match(/^ATA\s*([0-9A-Z.]+)$/);
        if(m){ currentATA = m[1]; continue; }

        // Find header row once
        if(headerIdx<0 && (firstUpper.includes('TASK CARD') || firstUpper.includes('AMM'))){
          headerIdx = r;
          for(let i=0;i<row.length;i++){
            const name = row[i].toUpperCase();
            if(name.includes('ATA')) cols.ata=i;
            if(name.includes('TASK CARD') || name.includes('AMM')) cols.tc=i;
            if(name.includes('TASK DESCRIPTION')) cols.desc=i;
            if(name.includes('TOOLS')) cols.tools=i;
            if(name.includes('CONSUMABLES')) cols.cons=i;
            if(name.includes('REMARKS')) cols.rem=i;
            if(name.includes('DURATION')) cols.dur=i;
            if(name.includes('MAN') && name.includes('HOUR')) cols.mh=i;      // optional in sheet
            if(name.includes('DUE')) cols.due=i;                               // optional in sheet
          }
          continue;
        }
        if(headerIdx<0) continue;                 // skip leading junk
        if(row.every(c=>c==='')) continue;       // skip blank lines

        const t = {
          ata: getCell(row, cols.ata) || currentATA || '',
          tc:  getCell(row, cols.tc),
          desc:getCell(row, cols.desc),
          tools:getCell(row, cols.tools),
          cons:getCell(row, cols.cons),
          rem: getCell(row, cols.rem),
          dur: getCell(row, cols.dur),
          manHours: getCell(row, cols.mh),       // might be blank; can edit later
          dueDate:  normalizeDate(getCell(row, cols.due)), // may be blank
          completed:false
        };
        if(!(t.tc||t.desc)) continue;            // ignore noise rows
        out.push(t);
      }
      return out;
    }
    function getCell(row, idx){ return (idx==null)?'':String(row[idx]||'').trim(); }
    function normalizeDate(s){
      if(!s) return '';
      // Try Excel serial number
      if(/^\d+$/.test(s)){
        const base = new Date(Date.UTC(1899,11,30));
        const dt = new Date(base.getTime() + parseInt(s,10)*86400000);
        return dt.toISOString().slice(0,10);
      }
      // Try parseable yyyy-mm-dd or dd/mm/yyyy
      const tryD = new Date(s);
      if(!isNaN(tryD)) return tryD.toISOString().slice(0,10);
      return s; // leave as-is
    }

    /****************
     * RENDER VIEWS *
     ****************/
    function renderAll(){
      populateATAFilter();
      renderSearch();
      renderList();
      updateCounters();
    }

    function populateATAFilter(){
      const select = document.getElementById('ataFilter');
      const set = Array.from(new Set(state.tasks.map(t=>String(t.ata||'').trim()).filter(Boolean)))
        .sort((a,b)=>a.localeCompare(b,undefined,{numeric:true}));
      select.innerHTML = '<option value="">All ATA</option>' + set.map(a=>`<option value="${escapeHTML(a)}">ATA ${escapeHTML(a)}</option>`).join('');
    }

    function updateCounters(){
      const remaining = state.tasks.filter(t=>!t.completed).length;
      document.getElementById('remainingPill').textContent = `Remaining: ${remaining}`;
    }

    function renderSearch(){
      const q=(document.getElementById('searchInput').value||'').toLowerCase();
      const ata=(document.getElementById('ataFilter').value||'').trim();
      let list = state.tasks.slice();
      if(ata) list = list.filter(t=>String(t.ata||'')===ata);
      if(q) list = list.filter(t=> (t.tc||'').toLowerCase().includes(q) || (t.desc||'').toLowerCase().includes(q));

      const wrap=document.getElementById('searchResults');
      if(!list.length){ wrap.innerHTML = '<p class="muted">No matching task cards.</p>'; return; }
      wrap.innerHTML = list.map(card).join('');
    }

    // Single card renderer with due-date colouring and complete toggle
    function card(t){
      const status = dueStatus(t.dueDate);
      const chipClass = status.class;
      const chipText  = status.text;
      const mh = t.manHours?`${escapeHTML(t.manHours)} h`:'—';
      const due = t.dueDate?escapeHTML(t.dueDate):'—';
      const check = t.completed?'checked':'';

      return `
      <div class="card" style="margin-top:12px">
        <div class="grid two">
          <div>
            <b>ATA ${escapeHTML(t.ata||'—')} • ${escapeHTML(t.tc||'—')}</b>
            <p class="muted" style="margin:6px 0">${escapeHTML(t.desc||'—')}</p>
          </div>
          <div style="text-align:right">
            <span class="due-chip ${chipClass}">${chipText}: ${due}</span>
            <span class="pill" style="margin-left:6px">Man Hours: ${mh}</span>
            <span class="pill" style="margin-left:6px">${escapeHTML(t.dur||'')}</span>
          </div>
        </div>

        <div class="grid two" style="margin-top:10px">
          <div>
            <label>Tools / Test Set</label>
            <div class="scroller">${nl2br(escapeHTML(t.tools||'-'))}</div>
          </div>
          <div>
            <label>Consumables / MSL</label>
            <div class="scroller">${nl2br(escapeHTML(t.cons||'-'))}</div>
          </div>
        </div>

        <div style="margin-top:10px">
          <label>Remarks</label>
          <div class="scroller">${nl2br(escapeHTML(t.rem||'-'))}</div>
        </div>

        <div class="toolbar" style="margin-top:10px;justify-content:space-between">
          <div class="muted">Duration: ${escapeHTML(t.dur||'—')}</div>
          <label class="muted" style="display:flex;align-items:center;gap:8px">
            <input type="checkbox" ${check} onchange="toggleComplete('${t.id}', this.checked)"> Mark as completed
          </label>
        </div>
      </div>`;
    }

    function toggleComplete(id, val){
      const i = state.tasks.findIndex(x=>x.id===id);
      if(i>-1){ state.tasks[i].completed = !!val; saveLocal(); updateCounters(); }
    }

    // Compute due status & class
    function dueStatus(iso){
      if(!iso) return {class:'due-ok', text:'No Due'};
      const today = new Date(); today.setHours(0,0,0,0);
      const d = new Date(iso); d.setHours(0,0,0,0);
      const diff = Math.round((d - today)/86400000);
      if(diff < 0)  return {class:'due-overdue', text:'Overdue'};
      if(diff === 0) return {class:'due-today', text:'Due Today'};
      if(diff <= 3) return {class:'due-soon', text:'Due Soon'};
      return {class:'due-ok', text:'On Track'};
    }

    /*********************
     * OFFICER QUICK EDIT *
     *********************/
    function renderList(){
      const wrap=document.getElementById('listWrap');
      if(!wrap || document.getElementById('tab-manage').style.display==='none') return;

      if(!state.tasks.length){ wrap.innerHTML='<p class="muted">No task cards yet.</p>'; return; }

      let html = `<table>
        <thead><tr>
          <th>ATA</th><th>Task Card / AMM</th><th>Description</th>
          <th>Due Date</th><th>Man Hours</th><th></th>
        </tr></thead><tbody>`;

      for(const t of state.tasks){
        html += `<tr>
          <td>${escapeHTML(t.ata||'')}</td>
          <td>${escapeHTML(t.tc||'')}</td>
          <td>${escapeHTML(t.desc||'')}</td>
          <td>
            <input type="date" value="${escapeAttr(t.dueDate||'')}" onchange="editField('${t.id}','dueDate', this.value)">
          </td>
          <td>
            <input type="number" min="0" step="0.1" value="${escapeAttr(t.manHours||'')}" placeholder="e.g. 4" onchange="editField('${t.id}','manHours', this.value)">
          </td>
          <td style="text-align:right">
            <button class="btn danger" onclick="delTask('${t.id}')">Delete</button>
          </td>
        </tr>`;
      }
      html += '</tbody></table>';
      wrap.innerHTML = html;
    }

    function editField(id, key, val){
      const i = state.tasks.findIndex(x=>x.id===id);
      if(i>-1){
        state.tasks[i][key] = (key==='manHours' && val)? String(val): (key==='dueDate'? normalizeDate(val): val);
        saveLocal();
        renderSearch();
        updateCounters();
      }
    }
    function delTask(id){
      if(!confirm('Delete this task?')) return;
      state.tasks = state.tasks.filter(t=>t.id!==id);
      saveLocal();
      renderAll();
    }
    function clearAll(){
      if(!confirm('This will remove all saved tasks on this device. Continue?')) return;
      state.tasks = [];
      saveLocal();
      renderAll();
    }

    /*************
     * UTILITIES *
     *************/
    function exportJSON(){
      const blob = new Blob([JSON.stringify(state.tasks,null,2)], {type:'application/json'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href=url; a.download='batik-taskcards.json'; a.click();
      URL.revokeObjectURL(url);
    }
    function escapeHTML(s){ return (s||'').replace(/[&<>"']/g, c=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;','\'':'&#39;'}[c])); }
    function escapeAttr(s){ return String(s||'').replace(/"/g,'&quot;'); }
    function nl2br(s){ return (s||'').replace(/\n/g,'<br>'); }

    /********************
     * DEMO SEED (ATA12)
     ********************/
    function seedDemo(){
      const seed=[
        {ata:'12', tc:'32-070-00-01', desc:'Service the nose landing gear shock strut (AMM TASK 12-15-41-610-802)',
         tools:`COM-1532 Cart - Servicing, Strut Oil
 Part #: 1104 Supplier: 30188
 Part #: 8774B Supplier: 94861
 Part #: 8844 Supplier: 94861
 Part #: 8844B Supplier: 94861
 Part #: HM-GT1-C-VS Supplier: 1HV74
 Part #: PF53481-9P Supplier: 94861
 Part #: PF54124-3P Supplier: 94861
 Part #: PF55451-1 Supplier: 94861
 Part #: PF55451-23 Supplier: 94861
 Part #: SH001 Supplier: D2029
 Opt Part #: HM-GT1-C Supplier: 1HV74

SPL-1521 Tool - Strut Inflation, Landing Gear
 Part #: F70200-35 Supplier: 81205
 Opt Part #: F70200-1 Supplier: 81205
 Opt Part #: F70200-14 Supplier: 81205
 Opt Part #: F70200-17 Supplier: 81205
 Opt Part #: F70200-18 Supplier: 81205

SPL-1829 Valve - Drain, Landing Gear Shock Strut Oil
 Part #: J32108-16 Supplier: 81205

STD-1103 Hose - Flexible, 5/8 Inch ID, Oil/Hydraulic Resistant, 6 ft
STD-1110 Container - Hydraulic Fluid Resistant, 5 Gallon (19 L)
STD-1157 Gauge - Pressure, 0-3000 PSIG (0-20685 KPa)`,
         cons:'AEROSHELL-LGF',
         rem:`SPL-1829 Valve - Drain, Landing Gear Shock Strut Oil
 Part #: J32108-16 Supplier: 81205
( alternate to use a container )`,
         dur:'4 HRS',
         manHours:'4',
         dueDate:new Date(Date.now()+86400000*2).toISOString().slice(0,10), // +2 days
         completed:false
        }
      ];
      seed.forEach(t=>t.id=uid());
      state.tasks = [...seed, ...state.tasks];
      saveLocal();
      alert('Demo ATA 12 task loaded.');
      renderAll();
    }

    /************************
     * Service Worker (PWA) *
     ************************/
    if ("serviceWorker" in navigator) {
      // Safe to register; will simply do nothing if file is missing
      window.addEventListener("load", function () {
        navigator.serviceWorker.register("/service-worker.js");
      });
    }
  </script>
</body>
</html>
