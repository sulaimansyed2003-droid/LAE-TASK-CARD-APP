<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>LAE Task Card App</title>
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#b20b4d">

  <style>
    :root{
      --bg:#faf7fb;--panel:#fff;--border:#e6d6e1;--ink:#2a2430;--muted:#6b6171;
      --brand:#b20b4d;--brand-2:#f3b500;--ok:#16a34a;--warn:#f59e0b;
      --due:#e57900;--danger:#dc2626;--done:#e8fff0;--shadow:0 10px 30px rgba(178,11,77,.12);
    }
    body{margin:0;font-family:system-ui,sans-serif;background:var(--bg);color:var(--ink)}
    .container{max-width:1100px;margin:0 auto;padding:18px}
    header{display:flex;align-items:center;justify-content:space-between;gap:16px;margin:6px 0 16px}
    .brand{display:flex;align-items:center;gap:10px;font-weight:700;color:var(--brand)}
    .brand .dot{width:10px;height:10px;border-radius:50%;background:var(--brand)}
    .pill{font-size:.8rem;border:1px solid var(--border);padding:6px 10px;border-radius:999px;background:#fff}
    .glass{background:var(--panel);border:1px solid var(--border);border-radius:16px;box-shadow:var(--shadow)}
    .card{padding:16px;border-radius:16px}
    .row{display:flex;gap:16px;flex-wrap:wrap}
    .col{flex:1;min-width:280px}
    label{display:block;font-size:.85rem;color:var(--muted);margin:12px 0 6px}
    input,textarea,select{width:100%;padding:10px;border-radius:10px;border:1px solid var(--border);background:#fff}
    textarea{min-height:90px}
    .btn{border:0;border-radius:12px;padding:10px 14px;font-weight:700;cursor:pointer}
    .btn.brand{background:var(--brand);color:#fff}
    .btn.ghost{background:#fff;border:1px solid var(--border);color:var(--ink)}
    .btn.warn{background:var(--brand-2);color:#3b2600}
    .btn.danger{background:var(--danger);color:#fff}
    .tabbar{display:flex;gap:8px;flex-wrap:wrap;margin:6px 0}
    .tab{padding:10px 12px;border-radius:10px;border:1px solid var(--border);cursor:pointer;background:#fff}
    .tab.active{outline:2px solid var(--brand)}
    .badge{display:inline-block;padding:4px 8px;border-radius:999px;font-size:.75rem;font-weight:700}
    .b-ok{background:#eaf8ef;color:#065f2a;border:1px solid #ccebd6}
    .b-warn{background:#fff7eb;color:#6b3b00;border:1px solid #ffe2b8}
    .b-due{background:#fff1e6;color:#6b2e00;border:1px solid #ffd1aa}
    .b-danger{background:#ffeff0;color:#7a0f16;border:1px solid #ffc9ce}
    .doneCard{background:var(--done);border:1px solid #bfe9cc}
    table{width:100%;border-collapse:collapse;margin-top:8px}
    th,td{border-bottom:1px solid var(--border);text-align:left;padding:10px}
    tr:hover{background:#faf3f7}
  </style>
</head>
<body>
  <div class="container">
    <header>
      <div class="brand"><span class="dot"></span><span>LAE Task Card App</span></div>
      <div class="pill" id="clockPill">—</div>
    </header>

    <!-- LOGIN -->
    <div id="auth" class="glass card">
      <h2 style="color:var(--brand)">Sign in</h2>
      <label>Select Name</label>
      <select id="nameInput"></select>
      <label>Staff ID</label>
      <input id="staffIdInput" placeholder="e.g. BID1234"/>
      <div class="toolbar" style="margin-top:12px">
        <button class="btn brand" onclick="signIn()">Continue</button>
        <button class="btn ghost" onclick="seedDemo()">Load demo tasks</button>
      </div>
    </div>

    <!-- APP -->
    <div id="app" class="glass card" style="display:none">
      <div class="tabbar" id="tabs"></div>
      <section id="tab-all" style="display:none">
        <h3>All Task Cards</h3>
        <div id="allResults"></div>
      </section>
      <section id="tab-completed" style="display:none">
        <h3>Completed Task Cards</h3>
        <div id="completedResults"></div>
      </section>
      <div style="margin-top:16px">
        <input type="file" id="excelFile" accept=".xlsx" style="display:none"/>
        <button class="btn warn" onclick="document.getElementById('excelFile').click()">Import Excel</button>
        <button class="btn ghost" onclick="signOut()">Sign Out</button>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/xlsx/dist/xlsx.full.min.js"></script>
  <script>
    const STORAGE_KEY="lae_taskcards_v4";
    let state={user:null,tasks:[]};

    /* ===== CLOCK ===== */
    function startClock(){
      const pill=document.getElementById("clockPill");
      setInterval(()=>{pill.textContent=new Date().toLocaleString()},1000);
    } startClock();

    /* ===== LOGIN NAMES ===== */
    const demoNames=[
      "Aiman","Farhan","Syafiq","Zul","Rashid","Hakim","Amir","Hafiz","Faiz","Danial",
      "Azim","Iqbal","Rafiq","Imran","Firdaus","Shahrul","Ridzuan","Haziq","Nabil","Khalid",
      "Hafeez","Amran","Azhar","Nasir","Shah","Rizal","Hilmi","Arif","Zaki","Faizal",
      "Rahman","Hanif","Shamil","Rauf","Zain","Luqman","Faris","Kamarul","Hakimi","Syed",
      "Nash","Hasif","Ashraf","Ridwan","Amzar","Firhan","Adam","Haikal","Muaz","Khairul"
    ];
    function populateNames(){
      const sel=document.getElementById("nameInput");
      sel.innerHTML='<option value="">Select your name</option>';
      demoNames.forEach(n=>{let o=document.createElement("option");o.value=n;o.textContent=n;sel.appendChild(o)});
    } populateNames();

    /* ===== STORAGE ===== */
    function saveLocal(){localStorage.setItem(STORAGE_KEY,JSON.stringify({tasks:state.tasks}))}
    function loadLocal(){try{const raw=localStorage.getItem(STORAGE_KEY);if(raw) state.tasks=JSON.parse(raw).tasks||[]}catch{}}

    /* ===== AUTH ===== */
    function signIn(){
      const name=document.getElementById("nameInput").value;
      const staffId=document.getElementById("staffIdInput").value.trim();
      if(!name||!staffId){alert("Select name and staff ID");return;}
      state.user={name,staffId};
      document.getElementById("auth").style.display="none";
      document.getElementById("app").style.display="block";
      loadLocal(); buildTabs(); renderAll();
    }
    function signOut(){location.reload();}

    /* ===== NAV ===== */
    function buildTabs(){
      const tabs=document.getElementById("tabs");
      tabs.innerHTML="";
      const make=(id,label)=>{let b=document.createElement("button");b.className="tab";b.textContent=label;b.onclick=()=>setTab(id);tabs.appendChild(b)}
      make("all","All Task Cards"); make("completed","Completed");
      setTab("all");
    }
    function setTab(id){
      ["all","completed"].forEach(x=>document.getElementById("tab-"+x).style.display="none");
      document.getElementById("tab-"+id).style.display="block";
      document.querySelectorAll(".tab").forEach(b=>b.classList.remove("active"));
      document.querySelectorAll(".tab")[id==="all"?0:1].classList.add("active");
      if(id==="all") renderAll(); else renderCompleted();
    }

    /* ===== DEMO ===== */
    function seedDemo(){
      state.tasks=[
        {id:uid(),ata:"12",tc:"32-07-00-01",desc:"Service the nose landing gear.",tools:"Tool A",cons:"Cons A",rem:"-",dur:"2H",mh:2,due:"2025-08-20",done:false},
        {id:uid(),ata:"20",tc:"CHK-POWER-AC",desc:"Pitot probe power check",tools:"Meter",cons:"-",rem:"-",dur:"1H",mh:1,due:"2025-08-18",done:false}
      ];
      saveLocal(); renderAll(); alert("Demo tasks loaded");
    }

    /* ===== RENDER ===== */
    function renderAll(){
      const wrap=document.getElementById("allResults");
      if(!state.tasks.length){wrap.innerHTML="<p>No tasks yet.</p>";return;}
      wrap.innerHTML=state.tasks.map(card).join("");
    }
    function renderCompleted(){
      const wrap=document.getElementById("completedResults");
      const results=state.tasks.filter(t=>t.done);
      if(!results.length){wrap.innerHTML="<p>No completed tasks.</p>";return;}
      wrap.innerHTML=results.map(card).join("");
    }

    function card(t){
      const doneCls=t.done?"doneCard":"";
      return `<div class="card ${doneCls}" style="margin-top:12px;border:1px solid var(--border)">
        <b>ATA ${esc(t.ata)} • ${esc(t.tc)}</b>
        <p class="muted">${esc(t.desc)}</p>
        <div><label>Duration:</label> ${esc(t.dur||"—")} • <label>MH:</label> ${esc(t.mh||"—")} • <label>Due:</label> ${esc(t.due||"—")}</div>
        <div style="margin-top:6px">
          ${t.assignedTo?`<span class="badge b-warn">Assigned to ${esc(t.assignedTo)}</span>`:`<button class="btn brand" onclick="assignToMe('${t.id}')">Assign to Me</button>`}
          <label style="margin-left:12px"><input type="checkbox" ${t.done?"checked":""} onchange="toggleDone('${t.id}',this.checked)"/> Done</label>
        </div>
      </div>`;
    }

    function assignToMe(id){const t=state.tasks.find(x=>x.id===id);if(!t)return;t.assignedTo=state.user.name;saveLocal();renderAll();}
    function toggleDone(id,val){const t=state.tasks.find(x=>x.id===id);if(!t)return;t.done=val;saveLocal();renderAll();renderCompleted();}

    /* ===== EXCEL IMPORT ===== */
    document.getElementById("excelFile").addEventListener("change",handleExcelFile);
    function handleExcelFile(ev){
      const file=ev.target.files[0];if(!file)return;
      const reader=new FileReader();
      reader.onload=e=>{
        const data=new Uint8Array(e.target.result);
        const wb=XLSX.read(data,{type:"array"});
        const ws=wb.Sheets[wb.SheetNames[0]];
        const rows=XLSX.utils.sheet_to_json(ws,{header:1,defval:""});
        const parsed=parseExcelRows(rows);
        for(const t of parsed){t.id=uid();t.done=false;}
        state.tasks=[...parsed,...state.tasks];
        saveLocal();renderAll();alert("Imported "+parsed.length+" tasks");
      };
      reader.readAsArrayBuffer(file); ev.target.value="";
    }
    function parseExcelRows(rows){
      const out=[];let header=null;
      for(const row of rows){
        if(!header){header=row.map(c=>c.toUpperCase());headerFound=true;continue;}
        if(row.every(c=>!c))continue;
        out.push({
          ata:row[header.indexOf("ATA")]||"",
          tc:row[header.findIndex(h=>h.includes("TASK CARD")||h.includes("AMM"))]||"",
          desc:row[header.findIndex(h=>h.includes("DESCRIPTION"))]||"",
          tools:row[header.findIndex(h=>h.includes("TOOLS"))]||"",
          cons:row[header.findIndex(h=>h.includes("CONSUMABLE"))]||"",
          rem:row[header.findIndex(h=>h.includes("REMARKS"))]||"",
          dur:row[header.findIndex(h=>h.includes("DURATION"))]||"",
          mh:row[header.findIndex(h=>h.includes("MAN"))]||"",
          due:row[header.findIndex(h=>h.includes("DUE"))]||""
        });
      }
      return out;
    }

    /* ===== HELPERS ===== */
    const uid=()=>Math.random().toString(36).slice(2)+Date.now().toString(36);
    function esc(s){return (s||"").replace(/[&<>"']/g,c=>({"&":"&amp;","<":"&lt;",">":"&gt;","\"":"&quot;","'":"&#39;"}[c]));}
  </script>
</body>
</html>
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>LAE Task Card App</title>
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#b20b4d">

  <style>
    :root{
      --bg:#faf7fb;--panel:#fff;--border:#e6d6e1;--ink:#2a2430;--muted:#6b6171;
      --brand:#b20b4d;--brand-2:#f3b500;--ok:#16a34a;--warn:#f59e0b;
      --due:#e57900;--danger:#dc2626;--done:#e8fff0;--shadow:0 10px 30px rgba(178,11,77,.12);
    }
    body{margin:0;font-family:system-ui,sans-serif;background:var(--bg);color:var(--ink)}
    .container{max-width:1100px;margin:0 auto;padding:18px}
    header{display:flex;align-items:center;justify-content:space-between;gap:16px;margin:6px 0 16px}
    .brand{display:flex;align-items:center;gap:10px;font-weight:700;color:var(--brand)}
    .brand .dot{width:10px;height:10px;border-radius:50%;background:var(--brand)}
    .pill{font-size:.8rem;border:1px solid var(--border);padding:6px 10px;border-radius:999px;background:#fff}
    .glass{background:var(--panel);border:1px solid var(--border);border-radius:16px;box-shadow:var(--shadow)}
    .card{padding:16px;border-radius:16px}
    .row{display:flex;gap:16px;flex-wrap:wrap}
    .col{flex:1;min-width:280px}
    label{display:block;font-size:.85rem;color:var(--muted);margin:12px 0 6px}
    input,textarea,select{width:100%;padding:10px;border-radius:10px;border:1px solid var(--border);background:#fff}
    textarea{min-height:90px}
    .btn{border:0;border-radius:12px;padding:10px 14px;font-weight:700;cursor:pointer}
    .btn.brand{background:var(--brand);color:#fff}
    .btn.ghost{background:#fff;border:1px solid var(--border);color:var(--ink)}
    .btn.warn{background:var(--brand-2);color:#3b2600}
    .btn.danger{background:var(--danger);color:#fff}
    .tabbar{display:flex;gap:8px;flex-wrap:wrap;margin:6px 0}
    .tab{padding:10px 12px;border-radius:10px;border:1px solid var(--border);cursor:pointer;background:#fff}
    .tab.active{outline:2px solid var(--brand)}
    .badge{display:inline-block;padding:4px 8px;border-radius:999px;font-size:.75rem;font-weight:700}
    .b-ok{background:#eaf8ef;color:#065f2a;border:1px solid #ccebd6}
    .b-warn{background:#fff7eb;color:#6b3b00;border:1px solid #ffe2b8}
    .b-due{background:#fff1e6;color:#6b2e00;border:1px solid #ffd1aa}
    .b-danger{background:#ffeff0;color:#7a0f16;border:1px solid #ffc9ce}
    .doneCard{background:var(--done);border:1px solid #bfe9cc}
    table{width:100%;border-collapse:collapse;margin-top:8px}
    th,td{border-bottom:1px solid var(--border);text-align:left;padding:10px}
    tr:hover{background:#faf3f7}
  </style>
</head>
<body>
  <div class="container">
    <header>
      <div class="brand"><span class="dot"></span><span>LAE Task Card App</span></div>
      <div class="pill" id="clockPill">—</div>
    </header>

    <!-- LOGIN -->
    <div id="auth" class="glass card">
      <h2 style="color:var(--brand)">Sign in</h2>
      <label>Select Name</label>
      <select id="nameInput"></select>
      <label>Staff ID</label>
      <input id="staffIdInput" placeholder="e.g. BID1234"/>
      <div class="toolbar" style="margin-top:12px">
        <button class="btn brand" onclick="signIn()">Continue</button>
        <button class="btn ghost" onclick="seedDemo()">Load demo tasks</button>
      </div>
    </div>

    <!-- APP -->
    <div id="app" class="glass card" style="display:none">
      <div class="tabbar" id="tabs"></div>
      <section id="tab-all" style="display:none">
        <h3>All Task Cards</h3>
        <div id="allResults"></div>
      </section>
      <section id="tab-completed" style="display:none">
        <h3>Completed Task Cards</h3>
        <div id="completedResults"></div>
      </section>
      <div style="margin-top:16px">
        <input type="file" id="excelFile" accept=".xlsx" style="display:none"/>
        <button class="btn warn" onclick="document.getElementById('excelFile').click()">Import Excel</button>
        <button class="btn ghost" onclick="signOut()">Sign Out</button>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/xlsx/dist/xlsx.full.min.js"></script>
  <script>
    const STORAGE_KEY="lae_taskcards_v4";
    let state={user:null,tasks:[]};

    /* ===== CLOCK ===== */
    function startClock(){
      const pill=document.getElementById("clockPill");
      setInterval(()=>{pill.textContent=new Date().toLocaleString()},1000);
    } startClock();

    /* ===== LOGIN NAMES ===== */
    const demoNames=[
      "Aiman","Farhan","Syafiq","Zul","Rashid","Hakim","Amir","Hafiz","Faiz","Danial",
      "Azim","Iqbal","Rafiq","Imran","Firdaus","Shahrul","Ridzuan","Haziq","Nabil","Khalid",
      "Hafeez","Amran","Azhar","Nasir","Shah","Rizal","Hilmi","Arif","Zaki","Faizal",
      "Rahman","Hanif","Shamil","Rauf","Zain","Luqman","Faris","Kamarul","Hakimi","Syed",
      "Nash","Hasif","Ashraf","Ridwan","Amzar","Firhan","Adam","Haikal","Muaz","Khairul"
    ];
    function populateNames(){
      const sel=document.getElementById("nameInput");
      sel.innerHTML='<option value="">Select your name</option>';
      demoNames.forEach(n=>{let o=document.createElement("option");o.value=n;o.textContent=n;sel.appendChild(o)});
    } populateNames();

    /* ===== STORAGE ===== */
    function saveLocal(){localStorage.setItem(STORAGE_KEY,JSON.stringify({tasks:state.tasks}))}
    function loadLocal(){try{const raw=localStorage.getItem(STORAGE_KEY);if(raw) state.tasks=JSON.parse(raw).tasks||[]}catch{}}

    /* ===== AUTH ===== */
    function signIn(){
      const name=document.getElementById("nameInput").value;
      const staffId=document.getElementById("staffIdInput").value.trim();
      if(!name||!staffId){alert("Select name and staff ID");return;}
      state.user={name,staffId};
      document.getElementById("auth").style.display="none";
      document.getElementById("app").style.display="block";
      loadLocal(); buildTabs(); renderAll();
    }
    function signOut(){location.reload();}

    /* ===== NAV ===== */
    function buildTabs(){
      const tabs=document.getElementById("tabs");
      tabs.innerHTML="";
      const make=(id,label)=>{let b=document.createElement("button");b.className="tab";b.textContent=label;b.onclick=()=>setTab(id);tabs.appendChild(b)}
      make("all","All Task Cards"); make("completed","Completed");
      setTab("all");
    }
    function setTab(id){
      ["all","completed"].forEach(x=>document.getElementById("tab-"+x).style.display="none");
      document.getElementById("tab-"+id).style.display="block";
      document.querySelectorAll(".tab").forEach(b=>b.classList.remove("active"));
      document.querySelectorAll(".tab")[id==="all"?0:1].classList.add("active");
      if(id==="all") renderAll(); else renderCompleted();
    }

    /* ===== DEMO ===== */
    function seedDemo(){
      state.tasks=[
        {id:uid(),ata:"12",tc:"32-07-00-01",desc:"Service the nose landing gear.",tools:"Tool A",cons:"Cons A",rem:"-",dur:"2H",mh:2,due:"2025-08-20",done:false},
        {id:uid(),ata:"20",tc:"CHK-POWER-AC",desc:"Pitot probe power check",tools:"Meter",cons:"-",rem:"-",dur:"1H",mh:1,due:"2025-08-18",done:false}
      ];
      saveLocal(); renderAll(); alert("Demo tasks loaded");
    }

    /* ===== RENDER ===== */
    function renderAll(){
      const wrap=document.getElementById("allResults");
      if(!state.tasks.length){wrap.innerHTML="<p>No tasks yet.</p>";return;}
      wrap.innerHTML=state.tasks.map(card).join("");
    }
    function renderCompleted(){
      const wrap=document.getElementById("completedResults");
      const results=state.tasks.filter(t=>t.done);
      if(!results.length){wrap.innerHTML="<p>No completed tasks.</p>";return;}
      wrap.innerHTML=results.map(card).join("");
    }

    function card(t){
      const doneCls=t.done?"doneCard":"";
      return `<div class="card ${doneCls}" style="margin-top:12px;border:1px solid var(--border)">
        <b>ATA ${esc(t.ata)} • ${esc(t.tc)}</b>
        <p class="muted">${esc(t.desc)}</p>
        <div><label>Duration:</label> ${esc(t.dur||"—")} • <label>MH:</label> ${esc(t.mh||"—")} • <label>Due:</label> ${esc(t.due||"—")}</div>
        <div style="margin-top:6px">
          ${t.assignedTo?`<span class="badge b-warn">Assigned to ${esc(t.assignedTo)}</span>`:`<button class="btn brand" onclick="assignToMe('${t.id}')">Assign to Me</button>`}
          <label style="margin-left:12px"><input type="checkbox" ${t.done?"checked":""} onchange="toggleDone('${t.id}',this.checked)"/> Done</label>
        </div>
      </div>`;
    }

    function assignToMe(id){const t=state.tasks.find(x=>x.id===id);if(!t)return;t.assignedTo=state.user.name;saveLocal();renderAll();}
    function toggleDone(id,val){const t=state.tasks.find(x=>x.id===id);if(!t)return;t.done=val;saveLocal();renderAll();renderCompleted();}

    /* ===== EXCEL IMPORT ===== */
    document.getElementById("excelFile").addEventListener("change",handleExcelFile);
    function handleExcelFile(ev){
      const file=ev.target.files[0];if(!file)return;
      const reader=new FileReader();
      reader.onload=e=>{
        const data=new Uint8Array(e.target.result);
        const wb=XLSX.read(data,{type:"array"});
        const ws=wb.Sheets[wb.SheetNames[0]];
        const rows=XLSX.utils.sheet_to_json(ws,{header:1,defval:""});
        const parsed=parseExcelRows(rows);
        for(const t of parsed){t.id=uid();t.done=false;}
        state.tasks=[...parsed,...state.tasks];
        saveLocal();renderAll();alert("Imported "+parsed.length+" tasks");
      };
      reader.readAsArrayBuffer(file); ev.target.value="";
    }
    function parseExcelRows(rows){
      const out=[];let header=null;
      for(const row of rows){
        if(!header){header=row.map(c=>c.toUpperCase());headerFound=true;continue;}
        if(row.every(c=>!c))continue;
        out.push({
          ata:row[header.indexOf("ATA")]||"",
          tc:row[header.findIndex(h=>h.includes("TASK CARD")||h.includes("AMM"))]||"",
          desc:row[header.findIndex(h=>h.includes("DESCRIPTION"))]||"",
          tools:row[header.findIndex(h=>h.includes("TOOLS"))]||"",
          cons:row[header.findIndex(h=>h.includes("CONSUMABLE"))]||"",
          rem:row[header.findIndex(h=>h.includes("REMARKS"))]||"",
          dur:row[header.findIndex(h=>h.includes("DURATION"))]||"",
          mh:row[header.findIndex(h=>h.includes("MAN"))]||"",
          due:row[header.findIndex(h=>h.includes("DUE"))]||""
        });
      }
      return out;
    }

    /* ===== HELPERS ===== */
    const uid=()=>Math.random().toString(36).slice(2)+Date.now().toString(36);
    function esc(s){return (s||"").replace(/[&<>"']/g,c=>({"&":"&amp;","<":"&lt;",">":"&gt;","\"":"&quot;","'":"&#39;"}[c]));}
  </script>
</body>
</html>
